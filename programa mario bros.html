<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Personaje en Grafo</title>
  <style>
    canvas {
      background: #111;
      display: block;
      margin: auto;
      border: 2px solid white;
    }
  </style>
</head>
<body>

<canvas id="canvas" width="800" height="500"></canvas>
<div id="nodeImageContainer" style="
  position: fixed;
  top: 20px;
  right: 20px;
  background: white;
  padding: 10px;
  border-radius: 10px;
  display: none;
">
  <img id="nodeImage" width="200">
</div>

<script>
let editMode = false;
const imageContainer = document.getElementById("nodeImageContainer");
const nodeImage = document.getElementById("nodeImage");
const canvas = document.getElementById("canvas");
const background = new Image();
background.src = "img/mapa.png";
const playerImage = new Image();
playerImage.src = "img/personaje.png";
const ctx = canvas.getContext("2d");

// ------------------ GRAFO ------------------
const nodes = [
  { id: 0,  x: 236, y: 147 },
  { id: 1,  x: 424, y: 81  },
  { id: 2,  x: 621, y: 153 },
  { id: 3,  x: 731, y: 245 },
  { id: 4, x: 570, y: 345 },
  { id: 5, x: 339, y: 408 },
  { id: 6, x: 197, y: 331 },
  { id: 7, x: 423, y: 255 }
];

const edges = {
  0: [1, 7],
  1: [0, 2,7],
  2: [1, 3,7],
  3: [2, 4],
  4: [3, 5,7],
  5: [4, 6],
  6: [5, 7],
  7: [6,4,2,1, 0]
};

// ------------------ PERSONAJE ------------------
let currentNode = 0;

const player = {
  x: nodes[currentNode].x,
  y: nodes[currentNode].y,
  speed: 2,
  path: []
};

// ------------------ DIBUJAR GRAFO ------------------
function drawGraph() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ✅ SOLO DIBUJAR MAPA DE FONDO
  ctx.drawImage(background, 0, 0, canvas.width, canvas.height);

  // ❌ YA NO SE DIBUJAN LÍNEAS
  // ❌ YA NO SE DIBUJAN NODOS
}
// ------------------ DIBUJAR PERSONAJE ------------------
function drawPlayer() {
  ctx.drawImage(
    playerImage,
    player.x - 20,  // centra el sprite en el nodo
    player.y - 20,
    40,   // ancho del personaje
    40    // alto del personaje
  );
}
// ------------------ BUSCAR CAMINO (BFS) ------------------
function findPath(start, end) {
  let queue = [[start]];
  let visited = new Set();

  while (queue.length > 0) {
    let path = queue.shift();
    let node = path[path.length - 1];

    if (node === end) return path;

    if (!visited.has(node)) {
      visited.add(node);

      for (let neighbor of edges[node]) {
        let newPath = [...path, neighbor];
        queue.push(newPath);
      }
    }
  }
  return [];
}
function showNodeImage(nodeId) {
  nodeImage.src = `img/${nodeId}.png`;
  imageContainer.style.display = "block";
}
// ------------------ MOVER PERSONAJE ------------------
function movePlayer() {
  if (player.path.length === 0) return;

  let targetNode = player.path[0];
  let target = nodes[targetNode];

  let dx = target.x - player.x;
  let dy = target.y - player.y;
  let dist = Math.hypot(dx, dy);

  if (dist < player.speed) {
    player.x = target.x;
    player.y = target.y;
    currentNode = targetNode;
    player.path.shift();

    // ✅ SI YA LLEGÓ AL DESTINO FINAL
    if (player.path.length === 0) {
      showNodeImage(currentNode);
    }

  } else {
    player.x += (dx / dist) * player.speed;
    player.y += (dy / dist) * player.speed;
  }
}
// ------------------ CLICK EN NODO ------------------
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

   if (editMode) {
    console.log(`Nodo ${nodes.length}: x=${Math.round(mx)}, y=${Math.round(my)}`);
    nodes.push({ id: nodes.length, x: mx, y: my });
    return;
  }

  for (let node of nodes) {
    let dist = Math.hypot(node.x - mx, node.y - my);
    if (dist < 15) {

      // ✅ ocultar imagen al iniciar movimiento
      imageContainer.style.display = "none";

      player.path = findPath(currentNode, node.id);
    }
  }
});
// ------------------ LOOP PRINCIPAL ------------------
function gameLoop() {
  drawGraph();
  movePlayer();
  drawPlayer();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>